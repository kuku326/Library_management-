{% extends "base.html" %}
{% block title %}图书查询{% endblock title%}
{% block style %}
    <style>
    a{
        text-decoration: none;
    }
    </style>

{% endblock style %}
{% block content %}
    <div id='rqbook'>
        <h1 class="page-header ">图书查询</h1>
        <form class="navbar-form navbar-right" action="/search.html" method="POST">
            <div class="btn-group">

              <select class="btn btn-default dropdown-toggle" name="key">
                  <option value="title" >书名</option>
                  <option value="price">价格</option>
                  <option value="publish">出版社</option>
                  <option value="pub_date">出版时间</option>
              </select>
            </div>
            <input type="text" class="form-control" placeholder="Search..." name="content">
            <button type="submit" class="form-control btn-warning">搜索</button>
        </form>
        <table id="rqtable" class="table table-bordered table-hover ">
            <tr>
                <th class="text-center">序号</th>
                <th class="text-center">书名</th>
                <th class="text-center">价格</th>
                <th class="text-center">出版社</th>
                <th class="text-center">出版时间</th>
                <th class="text-center">操作</th>
            </tr>
            {% for book_obj in all_of_book %}
                <tr>
                    <td class="text-center">{{ forloop.counter }}</td>
                    <td class="text-center">{{ book_obj.title }}</td>
                    <td class="text-center">{{ book_obj.price }}</td>
                    <td class="text-center">{{ book_obj.publish }}</td>
                    <td class="text-center">{{ book_obj.pub_date|date:"Y-m-d" }}</td>
                    <td class="text-center">

                        <!-- Button trigger modal -->
                        <button id='upd_op' type="button" class="btn btn-success btn-ms" data-toggle="modal" data-target="#myModal" name="{{ book_obj.title }}" >
                          编辑
                        </button>

                        <!-- Modal -->
                        <div class="modal fade text-left" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                          <div class="modal-dialog" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                <h4 class="modal-title" id="myModalLabel">图书编辑</h4>
                              </div>
                                <form action="/index.html" method="POST">
                                    <div class="modal-body">
                                        <div>
                                            <input class="form-control hide" id="disabledInput" name="id" type="text" >
                                        </div>
                                        <div>
                                            <label for="book_name" class="control-label">书名:</label>
                                            <input type="text" class="form-control" id="book_name" name="title">
                                        </div>
                                        <div>
                                            <label for="book_price" class="control-label">价格:</label>
                                            <input type="text" class="form-control" id="book_price" name="price">
                                        </div>
                                        <div>
                                            <label for="publish_name" class="control-label">出版社:</label>
                                            <input type="text" class="form-control" id="publish_name" name="publish">
                                        </div>
                                        <div>
                                            <label for="publish_date" class="control-label">出版时间:</label>
                                            <input type="text" class="form-control" id="publish_date" name="pub_date">
                                        </div>

                                    </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                    <button type="submit" class="btn btn-primary">提交</button>
                                  </div>
                                </form>

                            </div>
                          </div>
                        </div>

                        <!--删除-->
                        <!-- Button trigger modal -->
                        <button type="button" id="delete_id" class="btn btn-danger btn-ms" data-toggle="modal" data-target="#myModal2" name="{{ book_obj.title }}">
                          删除
                        </button>

                        <!-- Modal -->
                        <div class="modal fade" id="myModal2"  aria-labelledby="myModalLabel">
                          <div class="modal-dialog text-left" >
                            <form action="/delete.html" method="post">
                                <div class="modal-content">
                                  <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel">删除</h4>
                                  </div>

                                  <div class="modal-body">
                                      <input type="text" class="form-control hide" id="book_id" disbled name="id">
                                    您确定要删除吗？
                                  </div>
                                  <div class="modal-footer">
                                      <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                      <button type="sumbit" class="btn btn-danger">确定</button>
                                  </div>
                                </div>
                            </form>
                          </div>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>

    <div id='rcbook' class="hide">
        <h1  class="page-header">新增图书</h1>

        <form  class="form-horizontal" action="/create_book.html" method="post">
          <div class="form-group">
            <label for="inputbookName" class="col-sm-2 control-label">书名</label>
            <div class="col-sm-5">
              <input type="text" class="form-control" id="inputbookName" placeholder="书名" name="title">
            </div>
          </div>
          <div class="form-group">
            <label for="inputbookPrice" class="col-sm-2 control-label">价格</label>
            <div class="col-sm-5">
              <input type="text" class="form-control" id="inputbookPrice" placeholder="价格" name="price">
            </div>
          </div>
          <div class="form-group">
            <label for="inputpublish" class="col-sm-2 control-label">出版社</label>
            <div class="col-sm-5">
              <input type="text" class="form-control" id="inputpublish" placeholder="出版社" name="publish">
            </div>
          </div>
          <div class="form-group">
            <label for="inputpubDate" class="col-sm-2 control-label">出版时间</label>
            <div class="col-sm-5">
              <input type="text" class="form-control" id="inputpubDate" placeholder="年-月-日" name="pub_date">
            </div>
          </div>


          <div class="form-group">
            <div class="col-sm-offset-4 col-sm-5">
              <button type="submit" class="btn btn-danger">提交</button>
            </div>
          </div>
        </form>

    </div>


{% endblock content%}

{% block script %}
    <script>
        {{ update_result|safe }}
        {{ create_result|safe }}
        $('#myModal').on('shown.bs.modal', function () {
        $('#myInput').focus()
        })

        //编辑模态框
        $("button[id='upd_op']").click(function(){
            var get_name = $(this).attr('name');
            $.ajax({
                url:'/query_all.html',
                type:'post',
                data:{title:get_name},
                success:function (data) {
                    var data = JSON.parse(data);
                    $('#disabledInput').val(data.id);
                    $('#book_name').val(data.title);
                    $('#book_price').val(data.price);
                    $('#publish_name').val(data.publish);
                    $('#publish_date').val(data.pub_date);

                },
            })
        });

        //删除模态框
        $("button[id='delete_id']").click(function(){
            var get_name = $(this).attr('name');
            $.ajax({
                url:'/query_all.html',
                type:'post',
                data:{title:get_name},
                success:function (data) {
                    var data = JSON.parse(data);
                    $("#book_id").val(data.id);
                },
            })
        });

        //选定图书查询按钮，显示图书查询界面
        $("a[id='alq']").click(function(){
            $('#cbook').removeClass('active');
            $('#qbook').addClass('active');
            $('#rqbook').removeClass('hide');
            $('#rcbook').addClass('hide');
        });

        //选定图书创建按钮，显示图书创建界面
        $("a[id='alc']").click(function(){
            $('#cbook').addClass('active');
            $('#qbook').removeClass('active');
            $('#rqbook').addClass('hide');
            $('#rcbook').removeClass('hide');
        });

    </script>
{% endblock %}